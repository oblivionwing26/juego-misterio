<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Acceso Restringido</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #0f0;
            font-family: 'Source+Code+Pro', monospace;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .terminal {
            border: 2px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #0f0;
        }
        
        .question {
            margin: 15px 0;
            padding: 10px;
            border-left: 3px solid #0f0;
            background: rgba(0, 50, 0, 0.3);
        }
        
        input, button, textarea, select {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px 15px;
            margin: 5px;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 10px #0f0;
        }
        
        .lives {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .life {
            width: 20px;
            height: 20px;
            margin: 0 5px;
            background: #0f0;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .life.lost {
            background: #300;
            box-shadow: 0 0 5px #f00;
        }
        
        .hint {
            font-style: italic;
            color: #ff0;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .hint.show {
            opacity: 1;
        }
        
        .log {
            height: 100px;
            overflow-y: auto;
            background: rgba(0, 20, 0, 0.5);
            padding: 10px;
            margin-top: 20px;
            border: 1px solid #0f0;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 2px 0;
        }
        
        .cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background: #0f0;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Estilos para los retos */
        .reto-container {
            text-align: center;
            padding: 20px;
        }
        
        .reto-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ff0;
        }
        
        .reto-description {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .game-area {
            background: rgba(0, 30, 0, 0.5);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            position: relative;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #0f0;
            width: 0%;
            transition: width 0.5s;
        }
        
        /* Estilos para el juego del dinosaurio */
        .dino-game {
            position: relative;
            height: 250px;
            overflow: hidden;
            border: 1px solid #0f0;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 70%, #8FBC8F 70%, #228B22 100%);
        }
        
        .dino {
            position: absolute;
            bottom: 60px;
            left: 50px;
            width: 50px;
            height: 50px;
            font-size: 40px;
            line-height: 50px;
            text-align: center;
            transition: bottom 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
            transform: scaleX(-1); /* Girar para que mire a la derecha */
        }
        
        .dino.jumping {
            animation: jump 0.8s ease-out;
        }
        
        @keyframes jump {
            0% { bottom: 60px; }
            50% { bottom: 160px; }
            100% { bottom: 60px; }
        }
        
        .dino.running {
            animation: run 0.5s steps(2) infinite;
        }
        
        @keyframes run {
            0% { transform: scaleX(-1) translateX(0); }
            100% { transform: scaleX(-1) translateX(10px); }
        }
        
        .obstacle {
            position: absolute;
            bottom: 60px;
            right: 0;
            font-size: 35px;
            width: 35px;
            height: 35px;
            text-align: center;
            z-index: 5;
        }
        
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: #228B22;
            z-index: 1;
        }
        
        .mountain {
            position: absolute;
            bottom: 60px;
            width: 0;
            height: 0;
            border-left: 50px solid transparent;
            border-right: 50px solid transparent;
            border-bottom: 100px solid #2E8B57;
            z-index: 2;
        }
        
        .cloud {
            position: absolute;
            color: #fff;
            font-size: 40px;
            animation: cloudMove 20s linear infinite;
            z-index: 3;
        }
        
        @keyframes cloudMove {
            from { right: -100px; }
            to { right: 100%; }
        }
        
        .score {
            font-size: 1.2em;
            margin: 10px 0;
        }
        
        /* Estilos para el juego de memoria secuencial */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .memory-cell {
            width: 60px;
            height: 60px;
            background: #222;
            border: 1px solid #0f0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            transform-style: preserve-3d;
        }
        
        .memory-cell.flipped {
            transform: rotateY(180deg);
        }
        
        .memory-cell-front, .memory-cell-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
        }
        
        .memory-cell-front {
            background: #222;
            color: #0f0;
        }
        
        .memory-cell-back {
            background: #0a0;
            color: #000;
            transform: rotateY(180deg);
        }
        
        .memory-cell.correct {
            animation: pulse 0.5s;
        }
        
        .memory-cell.wrong {
            animation: shake 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotateY(180deg); }
            50% { transform: scale(1.2) rotateY(180deg); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotateY(180deg); }
            25% { transform: translateX(-5px) rotateY(180deg); }
            75% { transform: translateX(5px) rotateY(180deg); }
        }
        
        .round-info {
            font-size: 1.1em;
            margin: 10px 0;
        }
        
        .sequence-display {
            font-size: 1.3em;
            margin: 15px 0;
            min-height: 30px;
        }
        
        /* Estilos para el juego de lógica binaria */
        .binary-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .binary-operation {
            font-size: 1.8em;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid #0f0;
            border-radius: 5px;
            font-family: 'Source Code Pro', monospace;
        }
        
        .binary-input {
            font-size: 1.5em;
            width: 200px;
            text-align: center;
        }
        
        .binary-hint {
            font-style: italic;
            color: #ff0;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .binary-level {
            font-size: 1.2em;
            margin: 10px 0;
        }
        
        .binary-attempts {
            font-size: 1em;
            margin: 5px 0;
            color: #aaa;
        }
        
        /* Estilos para el juego de esteganografía */
        .stego-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .stego-text {
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 15px;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Source Code Pro', monospace;
            line-height: 1.6;
            font-size: 1em;
        }
        
        .stego-hint {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid #ff0;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-style: italic;
            color: #ff0;
        }
        
        .stego-input {
            width: 300px;
            text-align: center;
            font-size: 1.2em;
        }
        
        .stego-tools {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .stego-tool {
            padding: 8px 12px;
            background: rgba(0, 50, 0, 0.5);
            border: 1px solid #0f0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stego-tool:hover {
            background: rgba(0, 100, 0, 0.5);
            box-shadow: 0 0 5px #0f0;
        }
        
        .stego-colors {
            display: flex;
            gap: 5px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .color-box {
            width: 30px;
            height: 30px;
            border: 1px solid #0f0;
            border-radius: 3px;
        }
        
        /* Estilos para la capa final de seguridad */
        .final-security {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .security-text {
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 15px;
            width: 100%;
            font-family: 'Source Code Pro', monospace;
            line-height: 1.6;
            font-size: 1em;
            word-break: break-all;
        }
        
        .security-tools {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .tool-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .tool-row label {
            min-width: 120px;
            text-align: right;
        }
        
        .tool-row input, .tool-row select {
            flex: 1;
        }
        
        .book-excerpt {
            background: rgba(0, 20, 0, 0.5);
            border: 1px dashed #0f0;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .security-hint {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid #ff0;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-style: italic;
            color: #ff0;
        }
        
        /* Panel de desarrollo */
        .dev-panel {
            margin-top: 20px;
            text-align: center;
            padding: 10px;
            border: 1px dashed #0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="header">
            <h1>ACCESO RESTRINGIDO - SISTEMA DE SEGURIDAD NIVEL 3</h1>
            <p>Identificación requerida. 9 preguntas + 5 retos de verificación.</p>
        </div>
        
        <div class="lives" id="lives">
            <div class="life"></div>
            <div class="life"></div>
            <div class="life"></div>
        </div>
        
        <div id="question-container">
            <!-- Las preguntas se cargarán aquí -->
        </div>
        
        <div class="hint" id="hint"></div>
        
        <div class="log" id="log">
            <div class="log-entry">[SYSTEM] Iniciando protocolo de verificación...</div>
        </div>
        
        <!-- Panel de desarrollo -->
        <div class="dev-panel">
            <p>Panel de desarrollo:</p>
            <input type="text" id="dev-code" placeholder="Introduce código">
            <button onclick="verificarDevCode()">Avanzar</button>
        </div>
    </div>

    <script>
        // Base de datos de preguntas
        const preguntas = [
            {
                pregunta: "Como se llama el cangrejo verde de mi casa?",
                respuesta: "Calras",
                pista: "(🦞👳‍♀️)"
            },
            {
                pregunta: "Que me lanzaste en la playa?",
                respuesta: "Patata",
                pista: "(Una sola palabra)"
            },
            {
                pregunta: "Juego que has creado tu",
                respuesta: "Monkey gaming",
                pista: "(Mono)"
            },
            {
                pregunta: "¿Qué entidad invisible y absoluta, que existe sin depender de materia ni energía, fluye siempre en una sola dirección y marca el destino de todo lo que existe?",
                respuesta: "Tiempo",
                pista: "(Una palabra)"
            },
            {
                pregunta: "Que es lo que mas queria Eren",
                respuesta: "Libertad",
                pista: "🐚"
            },
            {
                pregunta: "¿Qué misterio une corazones distantes, desafía al tiempo y a la razón, y brilla incluso en la oscuridad más profunda?",
                respuesta: "Amor",
                pista: " (1 palabra)"
            },
            {
                pregunta: "Cual es el nombre del arma de la enamorada de Gehrman en Bloodborne?",
                respuesta: "Rakuyo",
                pista: "(1 palabra)"
            },
            {
                pregunta: "Quien fue el que 'invento' la Atlantida?",
                respuesta: "Platon",
                pista: "(o primero que la menciono)"
            },
            {
                pregunta: "Quis post finem mundi vivit et novam vitam hominibus affert? (Mythos Nordicus)",
                respuesta: "Líf and Lífþrasir",
                pista: "Ella y El"
            }
        ];
        
        // Pregunta final (será el reto 3)
        const preguntaFinal = {
            pregunta: "Esta es la pregunta 10, ultima, noche en que todo empezo",
            respuesta: "19/03/2019",
            pista: " DD/MM/YYYY"
        };
        
        let preguntaActual = 0;
        let vidas = 3;
        let pistasUsadas = 0;
        let retoActual = 0;
        let juegoActivo = false;
        
        // Variables para el juego del dinosaurio
        let dinoScore = 0;
        let dinoGameInterval;
        let dinoObstacleInterval;
        let dinoJumping = false;
        let gameSpeed = 5;
        let dinoRunning = false;
        let obstacles = [];
        let nextObstacleDistance = 400;
        let doubleObstacleChance = 0.3;
        
        // Variables para el juego de memoria secuencial
        let memoryRound = 1;
        let memorySequence = [];
        let memoryPlayerSequence = [];
        let memoryShowing = false;
        let memoryTimeout;
        let memoryNumbers = [];
        let memoryGrid = [];
        
        // Variables para el juego de lógica binaria
        let binaryLevel = 1;
        let binaryAttempts = 0;
        let maxBinaryAttempts = 3;
        let currentBinaryOperation = null;
        let binaryAnswer = null;
        
        // Variables para el juego de esteganografía
        let stegoAttempts = 0;
        let maxStegoAttempts = 3;
        let stegoMessage = "";
        let stegoText = "";
        let stegoRevealed = false;
        let stegoBinary = "";
        let stegoColors = [];
        
        // Variables para la capa final de seguridad
        let securityStep = 1;
        let securityAttempts = 0;
        let maxSecurityAttempts = 3;
        let securityMessage = "";
        let securityKey = "";
        
        function addLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function mostrarPregunta() {
            // Si ya se respondieron todas las preguntas, mostrar los retos
            if (preguntaActual >= preguntas.length) {
                mostrarRetos();
                return;
            }
            
            const p = preguntas[preguntaActual];
            document.getElementById('question-container').innerHTML = `
                <div class="question">
                    <p><strong>PREGUNTA ${preguntaActual + 1}/9:</strong> ${p.pregunta}</p>
                    <input type="text" id="respuesta" placeholder="Introduce tu respuesta">
                    <button onclick="verificarRespuesta()">Verificar</button>
                    <button onclick="mostrarPista()">Usar pista (${3 - pistasUsadas} restantes)</button>
                </div>
            `;
            
            document.getElementById('respuesta').focus();
            addLog(`Mostrando pregunta ${preguntaActual + 1}: ${p.pregunta.substring(0, 20)}...`);
        }
        
        function verificarRespuesta() {
            const respuesta = document.getElementById('respuesta').value.toLowerCase().trim();
            const correcta = preguntas[preguntaActual].respuesta.toLowerCase();
            
            if (respuesta === correcta) {
                addLog("Respuesta correcta. Avanzando...");
                preguntaActual++;
                mostrarPregunta();
            } else {
                vidas--;
                actualizarVidas();
                addLog(`Respuesta incorrecta. Vidas restantes: ${vidas}`);
                
                if (vidas <= 0) {
                    document.getElementById('question-container').innerHTML = `
                        <h2>ACCESO DENEGADO</h2>
                        <p>Has bloqueado el sistema al acumular suficientes errores. Reiniciando....</p>
                        <button onclick="location.reload()">Reiniciar sistema</button>
                    `;
                    addLog("Sistema bloqueado. Demasiados intentos fallidos.");
                } else {
                    document.getElementById('respuesta').value = '';
                    document.getElementById('respuesta').focus();
                }
            }
        }
        
        function mostrarPista() {
            if (pistasUsadas < 3) {
                pistasUsadas++;
                const pista = document.getElementById('hint');
                pista.textContent = `PISTA: ${preguntas[preguntaActual].pista}`;
                pista.classList.add('show');
                addLog(`Pista solicitada: ${preguntas[preguntaActual].pista.substring(0, 20)}...`);
                
                setTimeout(() => {
                    pista.classList.remove('show');
                }, 10000);
            }
        }
        
        function actualizarVidas() {
            const elementosVida = document.querySelectorAll('.life');
            elementosVida.forEach((vida, index) => {
                if (index >= vidas) {
                    vida.classList.add('lost');
                }
            });
        }
        
        function mostrarRetos() {
            retoActual = 0;
            mostrarRetoActual();
        }
        
        function mostrarRetoActual() {
            switch(retoActual) {
                case 0:
                    mostrarReto1();
                    break;
                case 1:
                    mostrarReto2();
                    break;
                case 2:
                    mostrarReto3();
                    break;
                case 3:
                    mostrarReto4();
                    break;
                case 4:
                    mostrarReto5();
                    break;
                case 5:
                    mostrarCapaFinal();
                    break;
                default:
                    // Todos los retos completados
                    mostrarCompletado();
            }
        }
        
        function mostrarReto1() {
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">RETO 1: Escape del Dinosaurio</div>
                    <div class="reto-description">
                        <p>Alcanza 5000 puntos para superar este reto.</p>
                        <p>Presiona ESPACIO para saltar los obstáculos.</p>
                    </div>
                    <div class="game-area">
                        <div class="dino-game" id="dino-game">
                            <div class="dino" id="dino">🦕</div>
                            <div class="mountain" style="left: 200px;"></div>
                            <div class="mountain" style="left: 400px; height: 80px; border-bottom-width: 80px;"></div>
                            <div class="mountain" style="left: 600px; height: 60px; border-bottom-width: 60px;"></div>
                            <div class="cloud" style="top: 30px; right: 100px;">☁️</div>
                            <div class="cloud" style="top: 60px; right: 300px;">☁️</div>
                            <div class="cloud" style="top: 40px; right: 500px;">☁️</div>
                            <div class="ground"></div>
                        </div>
                        <div class="score">Puntos: <span id="dino-score">0</span> | Velocidad: <span id="game-speed">1</span>x</div>
                        <button id="jump-btn" onclick="saltarDino()">Saltar (ESPACIO)</button>
                        <div class="progress-bar">
                            <div class="progress" id="progress1"></div>
                        </div>
                    </div>
                </div>
            `;
            
            iniciarJuegoDino();
            addLog("Iniciando Reto 1: Escape del Dinosaurio");
            
            // Añadir evento de teclado
            document.addEventListener('keydown', handleKeyDown);
        }
        
        function handleKeyDown(e) {
            if (retoActual === 0 && juegoActivo && e.code === 'Space') {
                e.preventDefault();
                saltarDino();
            }
        }
        
        function iniciarJuegoDino() {
            dinoScore = 0;
            gameSpeed = 5;
            juegoActivo = true;
            dinoRunning = true;
            obstacles = [];
            nextObstacleDistance = 400;
            doubleObstacleChance = 0.3;
            
            document.getElementById('dino-score').textContent = dinoScore;
            document.getElementById('game-speed').textContent = Math.floor(gameSpeed / 5);
            
            // Iniciar animación de correr
            const dino = document.getElementById('dino');
            dino.classList.add('running');
            
            // Crear primer obstáculo
            crearObstaculo(800);
            
            // Game loop
            dinoGameInterval = setInterval(() => {
                if (!juegoActivo) return;
                
                // Mover obstáculos
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    const obstacle = obstacles[i];
                    obstacle.x -= gameSpeed;
                    obstacle.element.style.right = (800 - obstacle.x) + 'px';
                    
                    // Eliminar obstáculos fuera de pantalla
                    if (obstacle.x < -50) {
                        obstacle.element.remove();
                        obstacles.splice(i, 1);
                        dinoScore += 100;
                        document.getElementById('dino-score').textContent = dinoScore;
                        updateProgress(1, dinoScore / 50);
                        
                        // Aumentar velocidad gradualmente
                        if (dinoScore % 500 === 0 && gameSpeed < 12) {
                            gameSpeed += 0.2;
                            document.getElementById('game-speed').textContent = Math.floor(gameSpeed / 5);
                        }
                        
                        // Aumentar dificultad gradualmente
                        if (dinoScore % 1000 === 0) {
                            doubleObstacleChance = Math.min(doubleObstacleChance + 0.05, 0.6);
                        }
                        
                        if (dinoScore >= 5000) {
                            completarReto1();
                        }
                    }
                    
                    // Verificar colisión
                    checkCollision(obstacle);
                }
                
                // Crear nuevos obstáculos
                nextObstacleDistance -= gameSpeed;
                if (nextObstacleDistance <= 0) {
                    const lastObstacle = obstacles[obstacles.length - 1];
                    const newX = lastObstacle ? lastObstacle.x + 300 : 800;
                    
                    crearObstaculo(newX);
                    
                    // Posibilidad de doble obstáculo
                    if (Math.random() < doubleObstacleChance) {
                        setTimeout(() => {
                            crearObstaculo(newX + 150);
                        }, 100);
                    }
                    
                    nextObstacleDistance = 300 + Math.random() * 200;
                }
            }, 30);
        }
        
        function crearObstaculo(x) {
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            obstacle.textContent = '🌳';
            obstacle.style.right = (800 - x) + 'px';
            document.getElementById('dino-game').appendChild(obstacle);
            
            obstacles.push({
                element: obstacle,
                x: x
            });
        }
        
        function checkCollision(obstacle) {
            const dino = document.getElementById('dino');
            const dinoRect = dino.getBoundingClientRect();
            const obstacleRect = obstacle.element.getBoundingClientRect();
            
            // Ajustar la caja de colisión del dinosaurio según su estado
            let dinoTop = dinoRect.top;
            let dinoBottom = dinoRect.bottom;
            let dinoLeft = dinoRect.left;
            let dinoRight = dinoRect.right;
            
            // Si está saltando, ajustar la caja de colisión
            if (dinoJumping) {
                dinoTop += 10;
                dinoBottom -= 10;
            }
            
            // Verificar colisión con mayor precisión
            if (
                dinoRight > obstacleRect.left + 8 &&
                dinoLeft < obstacleRect.right - 8 &&
                dinoBottom > obstacleRect.top + 8 &&
                dinoTop < obstacleRect.bottom - 8
            ) {
                // Colisión
                vidas--;
                actualizarVidas();
                addLog(`Colisión detectada. Vidas restantes: ${vidas}`);
                
                // Efecto visual de colisión
                obstacle.element.style.filter = 'brightness(2)';
                setTimeout(() => {
                    obstacle.element.style.filter = '';
                }, 300);
                
                if (vidas <= 0) {
                    finDelJuego();
                } else {
                    // Eliminar el obstáculo con el que colisionó
                    obstacle.element.remove();
                    const index = obstacles.indexOf(obstacle);
                    if (index > -1) {
                        obstacles.splice(index, 1);
                    }
                }
            }
        }
        
        function saltarDino() {
            if (dinoJumping) return;
            
            dinoJumping = true;
            dinoRunning = false;
            const dino = document.getElementById('dino');
            dino.classList.remove('running');
            dino.classList.add('jumping');
            
            setTimeout(() => {
                dino.classList.remove('jumping');
                dinoJumping = false;
                if (juegoActivo) {
                    dinoRunning = true;
                    dino.classList.add('running');
                }
            }, 800);
        }
        
        function completarReto1() {
            juegoActivo = false;
            clearInterval(dinoGameInterval);
            document.removeEventListener('keydown', handleKeyDown);
            
            // Limpiar obstáculos
            obstacles.forEach(obstacle => {
                obstacle.element.remove();
            });
            obstacles = [];
            
            const dino = document.getElementById('dino');
            dino.classList.remove('running');
            
            addLog("Reto 1 completado. Puntuación alcanzada: 5000");
            retoActual++;
            setTimeout(() => {
                mostrarRetoActual();
            }, 2000);
        }
        
        function mostrarReto2() {
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">RETO 2: Memoria Secuencial</div>
                    <div class="reto-description">
                        <p>Observa la secuencia de números y luego pulsalos en orden ascendente.</p>
                        <p>Cada ronda añade un número más. Debes completar 15 rondas.</p>
                    </div>
                    <div class="game-area">
                        <div class="round-info">Ronda: <span id="memory-round">1</span> / 15</div>
                        <div class="sequence-display" id="sequence-display">Preparando secuencia...</div>
                        <div class="memory-grid" id="memory-grid">
                            <!-- Las celdas se generarán aquí -->
                        </div>
                        <div class="progress-bar">
                            <div class="progress" id="progress2"></div>
                        </div>
                    </div>
                </div>
            `;
            
            iniciarJuegoMemoria();
            addLog("Iniciando Reto 2: Memoria Secuencial");
        }
        
        function iniciarJuegoMemoria() {
            memoryRound = 1;
            memorySequence = [];
            memoryPlayerSequence = [];
            memoryShowing = false;
            
            crearGridMemoria();
            siguienteRondaMemoria();
        }
        
        function crearGridMemoria() {
            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            memoryGrid = [];
            
            // Crear 25 celdas (5x5)
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'memory-cell';
                cell.dataset.index = i;
                
                // Crear frente y dorso de la carta
                const front = document.createElement('div');
                front.className = 'memory-cell-front';
                front.textContent = '?';
                
                const back = document.createElement('div');
                back.className = 'memory-cell-back';
                back.textContent = 'X'; // Por defecto, todas las celdas tienen X
                
                cell.appendChild(front);
                cell.appendChild(back);
                cell.addEventListener('click', () => pulsarCeldaMemoria(i));
                grid.appendChild(cell);
                memoryGrid.push(cell);
            }
        }
        
        function siguienteRondaMemoria() {
            document.getElementById('memory-round').textContent = memoryRound;
            updateProgress(2, (memoryRound - 1) / 15);
            
            // Añadir nuevo número a la secuencia
            const nuevoNumero = memoryRound;
            memorySequence.push(nuevoNumero);
            
            // Mostrar secuencia
            mostrarSecuenciaMemoria();
        }
        
        function mostrarSecuenciaMemoria() {
            memoryShowing = true;
            memoryPlayerSequence = [];
            
            const display = document.getElementById('sequence-display');
            display.textContent = 'Observa la secuencia...';
            
            // Limpiar celdas (voltear todas)
            memoryGrid.forEach(cell => {
                cell.classList.remove('flipped');
            });
            
            // Mostrar números uno por uno
            let delay = 0;
            const positions = [];
            
            // Generar posiciones aleatorias para cada número
            for (let i = 0; i < memorySequence.length; i++) {
                let pos;
                do {
                    pos = Math.floor(Math.random() * 25);
                } while (positions.includes(pos));
                positions.push(pos);
            }
            
            // Establecer los números en las celdas correspondientes
            memorySequence.forEach((num, index) => {
                const cell = memoryGrid[positions[index]];
                const back = cell.querySelector('.memory-cell-back');
                back.textContent = num;
            });
            
            // Mostrar cada número
            memorySequence.forEach((num, index) => {
                memoryTimeout = setTimeout(() => {
                    const cell = memoryGrid[positions[index]];
                    cell.classList.add('flipped');
                    
                    // Ocultar después de un tiempo
                    setTimeout(() => {
                        cell.classList.remove('flipped');
                        if (index === memorySequence.length - 1) {
                            // Último número, permitir al jugador
                            setTimeout(() => {
                                display.textContent = '¡Ahora pulsa los números en orden!';
                                memoryShowing = false;
                            }, 500);
                        }
                    }, 1000);
                }, delay);
                
                delay += 1500; // 1.5 segundos entre números
            });
        }
        
        function pulsarCeldaMemoria(index) {
            if (memoryShowing) return;
            
            const cell = memoryGrid[index];
            const back = cell.querySelector('.memory-cell-back');
            const expectedNum = memoryPlayerSequence.length + 1;
            
            // Voltear la celda
            cell.classList.add('flipped');
            
            // Verificar si es correcto
            if (back.textContent === expectedNum.toString()) {
                // Correcto
                cell.classList.add('correct');
                memoryPlayerSequence.push(expectedNum);
                
                setTimeout(() => {
                    cell.classList.remove('correct');
                    
                    // Verificar si completó la ronda
                    if (memoryPlayerSequence.length === memorySequence.length) {
                        // Ronda completada
                        if (memoryRound >= 15) {
                            completarReto2();
                        } else {
                            memoryRound++;
                            setTimeout(() => {
                                siguienteRondaMemoria();
                            }, 1000);
                        }
                    }
                }, 500);
            } else {
                // Incorrecto
                cell.classList.add('wrong');
                vidas--;
                actualizarVidas();
                addLog(`Secuencia incorrecta. Vidas restantes: ${vidas}`);
                
                setTimeout(() => {
                    cell.classList.remove('wrong');
                    
                    if (vidas <= 0) {
                        finDelJuego();
                    } else {
                        // Reiniciar ronda
                        setTimeout(() => {
                            mostrarSecuenciaMemoria();
                        }, 1000);
                    }
                }, 500);
            }
        }
        
        function completarReto2() {
            clearTimeout(memoryTimeout);
            addLog("Reto 2 completado. Todas las rondas superadas.");
            retoActual++;
            setTimeout(() => {
                mostrarRetoActual();
            }, 2000);
        }
        
        function mostrarReto3() {
            const p = preguntaFinal;
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">RETO 3: Pregunta Final</div>
                    <div class="question">
                        <p><strong>PREGUNTA FINAL:</strong> ${p.pregunta}</p>
                        <input type="text" id="respuesta-final" placeholder="Introduce tu respuesta">
                        <button onclick="verificarRespuestaFinal()">Verificar</button>
                        <button onclick="mostrarPistaFinal()">Usar pista (${3 - pistasUsadas} restantes)</button>
                    </div>
                </div>
            `;
            
            document.getElementById('respuesta-final').focus();
            addLog("Iniciando Reto 3: Pregunta Final");
        }
        
        function verificarRespuestaFinal() {
            const respuesta = document.getElementById('respuesta-final').value.toLowerCase().trim();
            const correcta = preguntaFinal.respuesta.toLowerCase();
            
            if (respuesta === correcta) {
                addLog("Respuesta correcta. Reto final completado.");
                retoActual++;
                setTimeout(() => {
                    mostrarRetoActual();
                }, 2000);
            } else {
                vidas--;
                actualizarVidas();
                addLog(`Respuesta incorrecta. Vidas restantes: ${vidas}`);
                
                if (vidas <= 0) {
                    finDelJuego();
                } else {
                    document.getElementById('respuesta-final').value = '';
                    document.getElementById('respuesta-final').focus();
                }
            }
        }
        
        function mostrarPistaFinal() {
            if (pistasUsadas < 3) {
                pistasUsadas++;
                const pista = document.getElementById('hint');
                pista.textContent = `PISTA: ${preguntaFinal.pista}`;
                pista.classList.add('show');
                addLog(`Pista solicitada: ${preguntaFinal.pista.substring(0, 20)}...`);
                
                setTimeout(() => {
                    pista.classList.remove('show');
                }, 10000);
            }
        }
        
        function mostrarReto4() {
            binaryLevel = 1;
            binaryAttempts = 0;
            stegoRevealed = false;
            
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">RETO 4: Lógica Binaria</div>
                    <div class="reto-description">
                        <p>Resuelve las operaciones lógicas binarias para superar este reto.</p>
                        <p>Debes completar 5 niveles de dificultad creciente.</p>
                    </div>
                    <div class="game-area">
                        <div class="binary-container">
                            <div class="binary-level">Nivel: <span id="binary-level">1</span> / 5</div>
                            <div class="binary-attempts">Intentos: <span id="binary-attempts">0</span> / 3</div>
                            <div class="binary-operation" id="binary-operation">Cargando operación...</div>
                            <div class="binary-hint" id="binary-hint"></div>
                            <input type="text" id="binary-answer" class="binary-input" placeholder="Respuesta binaria">
                            <button onclick="verificarRespuestaBinaria()">Verificar</button>
                            <div class="progress-bar">
                                <div class="progress" id="progress4"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            generarOperacionBinaria();
            addLog("Iniciando Reto 4: Lógica Binaria");
        }
        
        function generarOperacionBinaria() {
            document.getElementById('binary-level').textContent = binaryLevel;
            document.getElementById('binary-attempts').textContent = binaryAttempts;
            
            let operacion, respuesta, pista;
            
            // Generar operación según el nivel
            switch(binaryLevel) {
                case 1:
                    // Operación simple: AND/OR/XOR entre dos números
                    const num1 = Math.floor(Math.random() * 8) + 1;
                    const num2 = Math.floor(Math.random() * 8) + 1;
                    const ops = ['AND', 'OR', 'XOR'];
                    const op = ops[Math.floor(Math.random() * ops.length)];
                    
                    operacion = `${num1.toString(2).padStart(3, '0')} ${op} ${num2.toString(2).padStart(3, '0')}`;
                    
                    if (op === 'AND') {
                        respuesta = (num1 & num2).toString(2).padStart(3, '0');
                    } else if (op === 'OR') {
                        respuesta = (num1 | num2).toString(2).padStart(3, '0');
                    } else {
                        respuesta = (num1 ^ num2).toString(2).padStart(3, '0');
                    }
                    
                    pista = "Recuerda: AND=1 solo si ambos bits son 1, OR=1 si al menos un bit es 1, XOR=1 si los bits son diferentes.";
                    break;
                    
                case 2:
                    // Operación con NOT
                    const num3 = Math.floor(Math.random() * 16) + 1;
                    operacion = `NOT(${num3.toString(2).padStart(4, '0')})`;
                    respuesta = (~num3 & 0xF).toString(2).padStart(4, '0');
                    pista = "NOT invierte todos los bits: 0→1 y 1→0.";
                    break;
                    
                case 3:
                    // Operación combinada
                    const num4 = Math.floor(Math.random() * 8) + 1;
                    const num5 = Math.floor(Math.random() * 8) + 1;
                    const num6 = Math.floor(Math.random() * 8) + 1;
                    operacion = `(${num4.toString(2).padStart(3, '0')} AND ${num5.toString(2).padStart(3, '0')}) OR ${num6.toString(2).padStart(3, '0')}`;
                    respuesta = ((num4 & num5) | num6).toString(2).padStart(3, '0');
                    pista = "Resuelve primero la operación entre paréntesis.";
                    break;
                    
                case 4:
                    // Operación con desplazamiento
                    const num7 = Math.floor(Math.random() * 32) + 1;
                    const shift = Math.floor(Math.random() * 3) + 1;
                    const direction = Math.random() < 0.5 ? '<<' : '>>';
                    
                    operacion = `${num7.toString(2).padStart(5, '0')} ${direction} ${shift}`;
                    
                    if (direction === '<<') {
                        respuesta = ((num7 << shift) & 0x1F).toString(2).padStart(5, '0');
                    } else {
                        respuesta = (num7 >> shift).toString(2).padStart(5, '0');
                    }
                    
                    pista = "<< desplaza bits a la izquierda, >> desplaza bits a la derecha.";
                    break;
                    
                case 5:
                    // Operación compleja
                    const num8 = Math.floor(Math.random() * 16) + 1;
                    const num9 = Math.floor(Math.random() * 16) + 1;
                    const num10 = Math.floor(Math.random() * 16) + 1;
                    operacion = `NOT(${num8.toString(2).padStart(4, '0')} AND ${num9.toString(2).padStart(4, '0')}) XOR ${num10.toString(2).padStart(4, '0')}`;
                    respuesta = ((~(num8 & num9) & 0xF) ^ num10).toString(2).padStart(4, '0');
                    pista = "Resuelve paso a paso: primero el AND, luego el NOT, finalmente el XOR.";
                    break;
            }
            
            currentBinaryOperation = operacion;
            binaryAnswer = respuesta;
            
            document.getElementById('binary-operation').textContent = operacion + " = ?";
            document.getElementById('binary-hint').textContent = pista;
            document.getElementById('binary-answer').value = '';
            document.getElementById('binary-answer').focus();
            
            updateProgress(4, (binaryLevel - 1) / 5);
        }
        
        function verificarRespuestaBinaria() {
            const respuesta = document.getElementById('binary-answer').value.trim();
            
            if (respuesta === binaryAnswer) {
                addLog(`Respuesta binaria correcta: ${binaryAnswer}`);
                
                if (binaryLevel >= 5) {
                    completarReto4();
                } else {
                    binaryLevel++;
                    binaryAttempts = 0;
                    setTimeout(() => {
                        generarOperacionBinaria();
                    }, 1500);
                }
            } else {
                binaryAttempts++;
                document.getElementById('binary-attempts').textContent = binaryAttempts;
                
                if (binaryAttempts >= maxBinaryAttempts) {
                    vidas--;
                    actualizarVidas();
                    addLog(`Máximo de intentos alcanzado. Vidas restantes: ${vidas}`);
                    
                    if (vidas <= 0) {
                        finDelJuego();
                    } else {
                        binaryAttempts = 0;
                        setTimeout(() => {
                            generarOperacionBinaria();
                        }, 1000);
                    }
                } else {
                    addLog(`Respuesta incorrecta. Intentos restantes: ${maxBinaryAttempts - binaryAttempts}`);
                    document.getElementById('binary-answer').value = '';
                    document.getElementById('binary-answer').focus();
                }
            }
        }
        
        function completarReto4() {
            addLog("Reto 4 completado. Todos los niveles de lógica binaria superados.");
            retoActual++;
            setTimeout(() => {
                mostrarRetoActual();
            }, 2000);
        }
        
        function mostrarReto5() {
            stegoAttempts = 0;
            stegoRevealed = false;
            
            // Generar texto con mensaje oculto
            generarTextoEsteganografia();
            
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">RETO 5: Esteganografía Avanzada</div>
                    <div class="reto-description">
                        <p>Encuentra el mensaje oculto en el siguiente texto usando técnicas de esteganografía.</p>
                        <p>El mensaje está codificado usando múltiples capas de ocultación.</p>
                    </div>
                    <div class="game-area">
                        <div class="stego-container">
                            <div class="stego-attempts">Intentos: <span id="stego-attempts">0</span> / 3</div>
                            <div class="stego-text" id="stego-text">${stegoText}</div>
                            <div class="stego-hint" id="stego-hint">
                                El mensaje está oculto usando técnicas avanzadas de esteganografía.
                                Debes encontrar el patrón binario oculto, convertirlo a colores y reconocer la bandera.
                            </div>
                            <div class="stego-tools">
                                <div class="stego-tool" onclick="revelarPista1()">Pista 1: Binario</div>
                                <div class="stego-tool" onclick="revelarPista2()">Pista 2: Colores</div>
                                <div class="stego-tool" onclick="revelarPista3()">Pista 3: Bandera</div>
                            </div>
                            <div class="stego-colors" id="stego-colors"></div>
                            <input type="text" id="stego-answer" class="stego-input" placeholder="Mensaje oculto">
                            <button onclick="verificarRespuestaEsteganografia()">Verificar</button>
                            <div class="progress-bar">
                                <div class="progress" id="progress5"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('stego-attempts').textContent = stegoAttempts;
            updateProgress(5, 0);
            addLog("Iniciando Reto 5: Esteganografía Avanzada");
        }
        
        function generarTextoEsteganografia() {
            // Mensaje a ocultar: "España"
            stegoMessage = "España";
            
            // Convertir el mensaje a binario (cada carácter a 8 bits)
            stegoBinary = "";
            for (let i = 0; i < stegoMessage.length; i++) {
                const charCode = stegoMessage.charCodeAt(i);
                stegoBinary += charCode.toString(2).padStart(8, '0');
            }
            
            // Convertir binario a colores (cada 8 bits = 1 byte = 1 color RGB)
            stegoColors = [];
            for (let i = 0; i < stegoBinary.length; i += 8) {
                const byte = stegoBinary.substr(i, 8);
                const decimal = parseInt(byte, 2);
                
                // Mapear el valor decimal a colores de la bandera de España
                // Rojo: valores bajos (0-85), Amarillo: valores medios (86-170), Rojo: valores altos (171-255)
                let color;
                if (decimal <= 85) {
                    // Rojo español
                    color = `rgb(${170 + Math.floor(decimal / 85 * 85)}, 0, 0)`;
                } else if (decimal <= 170) {
                    // Amarillo español
                    const yellowValue = Math.floor((decimal - 86) / 84 * 255);
                    color = `rgb(${yellowValue}, ${yellowValue}, 0)`;
                } else {
                    // Rojo español
                    color = `rgb(${170 + Math.floor((decimal - 171) / 84 * 85)}, 0, 0)`;
                }
                
                stegoColors.push(color);
            }
            
            // Texto base con esteganografía
            const textoBase = `El sistema operativo es la base fundamental de cualquier computadora moderna. 
            Los algoritmos de encriptación garantizan la seguridad de los datos transmitidos. 
            La arquitectura de red determina cómo se conectan los dispositivos entre sí. 
            Los protocolos de comunicación establecen las reglas para el intercambio de información. 
            La inteligencia artificial está transformando numerosas industrias. 
            El análisis de datos permite descubrir patrones ocultos en grandes volúmenes de información. 
            La realidad virtual crea experiencias inmersivas para los usuarios. 
            La computación cuántica promete revolucionar el procesamiento de información.`;
            
            // Ocultar el binario en el texto usando espacios y caracteres invisibles
            let textoConBinario = "";
            let binIndex = 0;
            
            for (let i = 0; i < textoBase.length; i++) {
                const char = textoBase[i];
                textoConBinario += char;
                
                // Insertar bits usando espacios y caracteres invisibles
                if (char === ' ' && binIndex < stegoBinary.length) {
                    if (stegoBinary[binIndex] === '1') {
                        textoConBinario += '  '; // Espacio doble para bit 1
                    } else {
                        textoConBinario += ' '; // Espacio simple para bit 0
                    }
                    binIndex++;
                }
            }
            
            stegoText = textoConBinario;
        }
        
        function revelarPista1() {
            if (!stegoRevealed) {
                document.getElementById('stego-hint').innerHTML = `
                    <strong>Pista 1:</strong> Los espacios dobles representan bits '1' y los espacios simples representan bits '0'.
                    <br><strong>Secuencia binaria:</strong> ${stegoBinary}
                `;
                stegoRevealed = true;
            }
        }
        
        function revelarPista2() {
            if (!stegoRevealed) {
                document.getElementById('stego-hint').innerHTML = `
                    <strong>Pista 2:</strong> Cada grupo de 8 bits forma un byte que representa un color RGB.
                    <br><strong>Valores decimales:</strong> ${stegoBinary.match(/.{1,8}/g).map(byte => parseInt(byte, 2)).join(', ')}
                `;
                stegoRevealed = true;
            }
        }
        
        function revelarPista3() {
            if (!stegoRevealed) {
                // Mostrar los colores
                const colorsContainer = document.getElementById('stego-colors');
                colorsContainer.innerHTML = '';
                
                stegoColors.forEach(color => {
                    const colorBox = document.createElement('div');
                    colorBox.className = 'color-box';
                    colorBox.style.backgroundColor = color;
                    colorsContainer.appendChild(colorBox);
                });
                
                document.getElementById('stego-hint').innerHTML = `
                    <strong>Pista 3:</strong> Los colores forman la bandera de España (rojo-amarillo-rojo).
                    <br><strong>Colores RGB:</strong> ${stegoColors.join(', ')}
                `;
                stegoRevealed = true;
            }
        }
        
        function verificarRespuestaEsteganografia() {
            const respuesta = document.getElementById('stego-answer').value.trim();
            
            if (respuesta.toLowerCase() === "españa") {
                addLog(`Mensaje esteganográfico encontrado: ${respuesta}`);
                completarReto5();
            } else {
                stegoAttempts++;
                document.getElementById('stego-attempts').textContent = stegoAttempts;
                
                if (stegoAttempts >= maxStegoAttempts) {
                    vidas--;
                    actualizarVidas();
                    addLog(`Máximo de intentos alcanzado. Vidas restantes: ${vidas}`);
                    
                    if (vidas <= 0) {
                        finDelJuego();
                    } else {
                        stegoAttempts = 0;
                        setTimeout(() => {
                            mostrarReto5();
                        }, 1000);
                    }
                } else {
                    addLog(`Mensaje incorrecto. Intentos restantes: ${maxStegoAttempts - stegoAttempts}`);
                    document.getElementById('stego-answer').value = '';
                    document.getElementById('stego-answer').focus();
                }
            }
        }
        
        function completarReto5() {
            addLog("Reto 5 completado. Mensaje esteganográfico descifrado.");
            retoActual++;
            setTimeout(() => {
                mostrarRetoActual();
            }, 2000);
        }
        
        function mostrarCapaFinal() {
            securityStep = 1;
            securityAttempts = 0;
            
            // Mensaje cifrado final
            securityMessage = "535441524c4947485420435245505455444f";
            
            document.getElementById('question-container').innerHTML = `
                <div class="reto-container">
                    <div class="reto-title">CAPA FINAL DE SEGURIDAD</div>
                    <div class="reto-description">
                        <p>Has superado todos los retos, pero aún debes descifrar el mensaje final.</p>
                        <p>Este es el último obstáculo antes de obtener el acceso completo.</p>
                    </div>
                    <div class="game-area">
                        <div class="final-security">
                            <div class="security-step">Paso: <span id="security-step">1</span> / 4</div>
                            <div class="security-attempts">Intentos: <span id="security-attempts">0</span> / 3</div>
                            
                            <div class="security-text" id="security-text">
                                ${securityMessage}
                            </div>
                            
                            <div class="security-hint" id="security-hint">
                                <strong>Pista inicial:</strong> El mensaje está codificado en hexadecimal. 
                                Conviértelo a texto para continuar.
                            </div>
                            
                            <div class="security-tools">
                                <div class="tool-row">
                                    <label>Resultado:</label>
                                    <input type="text" id="security-result" placeholder="Introduce el resultado">
                                </div>
                            </div>
                            
                            <button onclick="verificarPasoSeguridad()">Verificar</button>
                            
                            <div class="book-excerpt" id="book-excerpt" style="display: none;">
                                <!-- El extracto del libro se mostrará aquí -->
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress" id="progress6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('security-attempts').textContent = securityAttempts;
            updateProgress(6, 0);
            addLog("Iniciando Capa Final de Seguridad");
        }
        
        function verificarPasoSeguridad() {
            const resultado = document.getElementById('security-result').value.trim();
            let correcto = false;
            
            switch(securityStep) {
                case 1:
                    // Paso 1: Hexadecimal a texto
                    if (resultado === "STARLIGHT CREPTUDO") {
                        correcto = true;
                        securityStep++;
                        securityMessage = "U1RBUkxJR0hUIENSRVBUVURPIFRFWFRPIEZJTkFMCg==";
                        
                        document.getElementById('security-step').textContent = securityStep;
                        document.getElementById('security-text').textContent = securityMessage;
                        document.getElementById('security-hint').innerHTML = `
                            <strong>Paso 2:</strong> El nuevo mensaje está en Base64. 
                            Conviértelo a texto para continuar.
                        `;
                        document.getElementById('security-result').value = '';
                        updateProgress(6, 0.25);
                        
                        addLog("Paso 1 completado: Hexadecimal a texto");
                    }
                    break;
                    
                case 2:
                    // Paso 2: Base64 a texto
                    if (resultado === "STARLIGHT CREPTUDO TEXT OF FINAL") {
                        correcto = true;
                        securityStep++;
                        securityMessage = "V1hWVUdZVUJUWVJXVlVHWVVCVFZSV1ZVRllVQlRWUlc=";
                        
                        document.getElementById('security-step').textContent = securityStep;
                        document.getElementById('security-text').textContent = securityMessage;
                        document.getElementById('security-hint').innerHTML = `
                            <strong>Paso 3:</strong> Este mensaje también está en Base64, pero necesitas una clave.
                            <br>La clave está en el libro "Simulacros y Simulación", página 42, línea 3, palabra 5.
                        `;
                        document.getElementById('security-result').value = '';
                        
                        // Mostrar extracto del libro
                        const bookExcerpt = `Página 42:
                        Línea 1: La simulación no es una copia de lo real, sino que reemplaza a lo real.
                        Línea 2: En la era de la simulación, los signos ya no remiten a nada real.
                        Línea 3: El mapa precede al territorio y genera el territorio. La simulación es la realidad.
                        Línea 4: Hiperrealidad es el resultado de la simulación total.
                        Línea 5: Los modelos generan lo real sin necesidad de referentes externos.`;
                        
                        document.getElementById('book-excerpt').textContent = bookExcerpt;
                        document.getElementById('book-excerpt').style.display = 'block';
                        
                        updateProgress(6, 0.5);
                        
                        addLog("Paso 2 completado: Base64 a texto");
                    }
                    break;
                    
                case 3:
                    // Paso 3: Base64 con clave
                    if (resultado.toLowerCase() === "simulacion") {
                        correcto = true;
                        securityStep++;
                        securityMessage = "V1hWVUdZVUJUWVJXVlVHWVVCVFZSV1ZVRllVQlRWUlc=";
                        
                        document.getElementById('security-step').textContent = securityStep;
                        document.getElementById('security-text').textContent = securityMessage;
                        document.getElementById('security-hint').innerHTML = `
                            <strong>Paso 4:</strong> Usa la clave encontrada para descifrar el mensaje Base64.
                            <br>El resultado final es la contraseña del sistema.
                        `;
                        document.getElementById('security-result').value = '';
                        updateProgress(6, 0.75);
                        
                        addLog("Paso 3 completado: Clave encontrada");
                    }
                    break;
                    
                case 4:
                    // Paso 4: Descifrar con clave
                    if (resultado.toLowerCase() === "reconquista") {
                        correcto = true;
                        updateProgress(6, 1);
                        
                        addLog("Paso 4 completado: Mensaje final descifrado");
                        setTimeout(() => {
                            mostrarCompletado();
                        }, 2000);
                    }
                    break;
            }
            
            if (!correcto) {
                securityAttempts++;
                document.getElementById('security-attempts').textContent = securityAttempts;
                
                if (securityAttempts >= maxSecurityAttempts) {
                    vidas--;
                    actualizarVidas();
                    addLog(`Máximo de intentos alcanzado. Vidas restantes: ${vidas}`);
                    
                    if (vidas <= 0) {
                        finDelJuego();
                    } else {
                        securityAttempts = 0;
                        setTimeout(() => {
                            mostrarCapaFinal();
                        }, 1000);
                    }
                } else {
                    addLog(`Respuesta incorrecta. Intentos restantes: ${maxSecurityAttempts - securityAttempts}`);
                    document.getElementById('security-result').value = '';
                    document.getElementById('security-result').focus();
                }
            }
        }
        
        function updateProgress(reto, porcentaje) {
            const progress = document.getElementById(`progress${reto}`);
            if (progress) {
                progress.style.width = `${porcentaje * 100}%`;
            }
        }
        
        function mostrarCompletado() {
            document.getElementById('question-container').innerHTML = `
                <h2>ACCESO CONCEDIDO</h2>
                <p>Has superado todas las capas de seguridad del sistema.</p>
                <p>Contraseña final: <strong>RECONQUISTA</strong></p>
                <p>¡Felicidades por completar el desafío!</p>
            `;
            addLog("Verificación completada. Acceso concedido al sistema.");
        }
        
        function finDelJuego() {
            juegoActivo = false;
            clearInterval(dinoGameInterval);
            clearTimeout(memoryTimeout);
            document.removeEventListener('keydown', handleKeyDown);
            
            document.getElementById('question-container').innerHTML = `
                <h2>ACCESO DENEGADO</h2>
                <p>Has bloqueado el sistema al acumular suficientes errores. Reiniciando....</p>
                <button onclick="location.reload()">Reiniciar sistema</button>
            `;
            addLog("Sistema bloqueado. Demasiados intentos fallidos.");
        }
        
        // Función para verificar el código de desarrollo
        function verificarDevCode() {
            const code = document.getElementById('dev-code').value;
            if (code === '5659448') {
                addLog("Código de desarrollo aceptado. Avanzando al siguiente paso...");
                
                // Si estamos en las preguntas, avanzar a la siguiente pregunta
                if (preguntaActual < preguntas.length) {
                    preguntaActual++;
                    mostrarPregunta();
                } 
                // Si estamos en los retos, avanzar al siguiente reto
                else if (retoActual < 6) {
                    retoActual++;
                    mostrarRetoActual();
                }
                // Si ya completamos todo, mostrar completado
                else {
                    mostrarCompletado();
                }
                
                // Limpiar el campo de código
                document.getElementById('dev-code').value = '';
            } else {
                addLog("Código de desarrollo incorrecto.");
            }
        }
        
        // Iniciar el juego cuando el DOM esté completamente cargado
        document.addEventListener('DOMContentLoaded', function() {
            mostrarPregunta();
            addLog("Sistema listo. Esperando entrada del usuario...");
        });
    </script>
</body>
</html>
